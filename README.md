# KGInPaint: InPainting with Interactive Scene Graphs

This readme serves as a manual for setting up the RelTR Scene Graph Generation model and then setting up the KGInPaint dashboard for inpainting within an input image using the generated scene graph for a given image. It is advised that you run KGInPaint on a device with a CUDA compatible GPU.

Our Project Report Website can be accessed using this [link](https://github.gatech.edu/pages/adeshpande322/KGInPaint/).

## Demo Video

Please click on the Video Thumbnail below to watch the demo for our KGInPaint Dashboard.

[![KGInPaint Demo Video Link](https://github.gatech.edu/storage/user/79486/files/77066986-0479-4bca-817f-6186f01f3b85)](https://www.youtube.com/watch?v=tGeAod6Y3TA)


## Virtual Environment & Requirements

If you do not have Python virtualenv installed, please run the following command to install virtualenv:

```pip install virtualenv``` or ```pip3 install virtualenv``` or ```python3 -m pip install virtualenv```

Setup the virtualenv by running the following commands:

```
python3 -m virtualenv .kginpaint_env
source .kginpaint/bin/activate
```

Alternatively you can setup a Conda Environment by installing conda by following this [link](https://conda.io/projects/conda/en/latest/user-guide/install/index.html). (Recommended)

Run the following command to setup a new conda environment with Python version 3.11.8:

```
conda create -n kginpaint_env python=3.11.8
conda activate kginpaint_env
```

Install the necessary requirements using the following command:

```pip install -r requirements.txt```

## RelTR Setup

Download the [RelTR model](https://drive.google.com/file/d/1id6oD_iwiNDD6HyCn2ORgRTIKkPD3tUD/view) pretrained on the Visual Genome dataset and put it under 
```
./sgg_model/ckpt/checkpoint0149.pth
```

Note that the RelTR model codebase has been added here in this repository for user's convenience. We have cited their work for this project. Please visit this [link](https://github.com/yrcong/RelTR) for their original code for generating Scene graphs.

## Input Images Setup

Move all your input images to the folder ```./data/images``` by using the following command:

```
mv [your_curr_directory]/[your_input_image].jpg [repository_directory]/KGInPaint/data/images
```

## Using the KGInPaint Dashboard

You first need to host the application using the following command. Please ensure that your virtual environment is activated before running the application.

```python3 kginpaint_app.py```

Access the app in your browser by visiting this URL: ```http://localhost:8050/```

You have now setup the KGInPaint dashboard for your inpainting process. Add your input image by dragging and dropping your image or by browsing it through your files. 

### Scene Graph Manipulation Features

Give the RelTR model a few seconds to predict the Scene Graph (you will see 'Updating' on your browser tab) for your input image and it would present a Scene Graph for your input image on the dashboard shortly. The user can now select nodes or edges on the displayed scene graph. Their selected entities will be highlighted in the input image as well. The dashboard has a dropdown that will help the user to highlight specific relationships in blue within the selected input image. Additionally you can Zoom and Pan both the Scene Graph and the Displayed Input Image

### Inpainting Features:

* **Remove Object**: To Remove an Object, please select a node on the displayed Scene Graph. You will see the selected object's label highlighted in the Scene Graph and its corresponding detected bounding box on the image. Press the 'Remove Object' button. 

* **Replace Object**: To Remove an Object, please select a node on the displayed Scene Graph. You will see the selected object's label highlighted in the Scene Graph and its corresponding detected bounding box on the image. Please add the object you want to replace the selected object with in the Text Bos beside the 'Replace Object' button. Once you have written your prompt, press the 'Replace Object' button.

You will see 'Updating' on your browser tab while the Inpainting process runs in background. Once Inpainting is complete, you can scroll down to see a carousel displaying different output options generated by the Inpainting model. You can use right click to save the image.

## Author
* Aniruddha Prashant Deshpande [Github Profile](https://github.com/aniruddhapdeshpande99)
